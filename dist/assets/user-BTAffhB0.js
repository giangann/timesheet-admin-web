import{j as e,B as C,T as S,r as o,A as J,I as F,a as f,P as V,M as Y,m as U,b as M,c as T,d as Z,u as O,e as ee,D as ne,S as se,H as te}from"./index-CiyAc5l9.js";import{C as re}from"./config-global-ClKwKbZP.js";import{T as D,a as b,b as oe,C as L,c as ie,D as G,d as A,e as R,f as ae,g as le,h as ce,i as de}from"./Tooltip-Bw5PYoiz.js";import{D as $,a as he}from"./dialogTitleClasses-Bswz518M.js";import{G as j,C as xe}from"./Grid-DiL9jkRp.js";import{O as ue,T as me}from"./TextField-DAHlXdg2.js";import{I as pe}from"./InputAdornment-3JCUqBsx.js";import{u as ge,s as be}from"./use-download-d4gRJN68.js";import{u as fe}from"./use-user-H15zXjPe.js";import{u as q}from"./use-api-CDdvI0gq.js";function je(n){if(!n)return;const r=atob(n),t=new Array(r.length);r.split("").forEach((d,i)=>{t[i]=r.charCodeAt(i)});const a=new Uint8Array(t);return new Blob([a])}function Ce({emptyRows:n,height:r,sx:t,...a}){return n?e.jsx(D,{sx:{...r&&{height:r*n},...t},...a,children:e.jsx(b,{colSpan:9})}):null}function ve({searchQuery:n,...r}){return e.jsx(D,{...r,children:e.jsx(b,{align:"center",colSpan:7,children:e.jsxs(C,{sx:{py:15,textAlign:"center"},children:[e.jsx(S,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(S,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',n,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const ke={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function ye(n,r,t){return n?Math.max(0,(1+n)*r-t):0}function B(n,r,t){return r[t]<n[t]?-1:r[t]>n[t]?1:0}function Se(n,r){return n==="desc"?(t,a)=>B(t,a,r):(t,a)=>-B(t,a,r)}function Pe({inputData:n,comparator:r,filterName:t}){const a=n.map((l,d)=>[l,d]);return a.sort((l,d)=>{const i=r(l[0],d[0]);return i!==0?i:l[1]-d[1]}),n=a.map(l=>l[0]),t&&(n=n.filter(l=>l.name.toLowerCase().indexOf(t.toLowerCase())!==-1)),n}function we({order:n,onSort:r,orderBy:t,rowCount:a,headLabel:l,numSelected:d,onSelectAllRows:i}){return e.jsx(oe,{children:e.jsxs(D,{children:[e.jsx(b,{padding:"checkbox",children:e.jsx(L,{indeterminate:d>0&&d<a,checked:a>0&&d===a,onChange:s=>i(s.target.checked)})}),l.map(s=>e.jsx(b,{align:s.align||"left",sortDirection:t===s.id?n:!1,sx:{width:s.width,minWidth:s.minWidth},children:e.jsxs(ie,{hideSortIcon:!0,active:t===s.id,direction:t===s.id?n:"asc",onClick:()=>r(s.id),children:[s.label,t===s.id?e.jsx(C,{sx:{...ke},children:n==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id))]})})}function Te({row:n,selected:r,onSelectRow:t,onDeleteUser:a,onGotoDetail:l}){const[d,i]=o.useState(null),[s,g]=o.useState(!1),P=o.useCallback(p=>{i(p.currentTarget)},[]),h=o.useCallback(()=>{i(null)},[]),x=o.useCallback(()=>{g(!0)},[g]),m=o.useCallback(()=>{g(!1)},[g]),v=o.useCallback(()=>{h(),x()},[h,x]),y=o.useCallback(()=>{h(),l(n)},[h,l,n]),k=o.useCallback(()=>{m(),a(n)},[m,a,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(D,{hover:!0,tabIndex:-1,role:"checkbox",selected:r,children:[e.jsx(b,{padding:"checkbox",children:e.jsx(L,{disableRipple:!0,checked:r,onChange:t})}),e.jsx(b,{component:"th",scope:"row",children:e.jsxs(C,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(J,{alt:n.name,src:"null"}),n.name]})}),e.jsx(b,{children:n.team.name}),e.jsx(b,{children:n.team.hotline??"-"}),e.jsx(b,{children:n.roleName}),e.jsx(b,{children:n.phone??"-"}),e.jsx(b,{children:n.address??"-"}),e.jsx(b,{children:n.email??"-"}),e.jsx(b,{align:"right",children:e.jsx(F,{onClick:P,children:e.jsx(f,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(V,{open:!!d,anchorEl:d,onClose:h,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(Y,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${U.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${U.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(M,{onClick:y,children:[e.jsx(f,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(M,{onClick:v,sx:{color:"error.main"},children:[e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx($,{open:s,onClose:m,children:e.jsxs(C,{sx:{p:4,pb:4},children:[e.jsxs(C,{position:"relative",children:[e.jsx(G,{sx:{textAlign:"left"},children:"Xác nhận xóa?"}),e.jsx(C,{position:"absolute",top:"15%",right:0,children:e.jsx(A,{title:"Đóng",children:e.jsx(F,{onClick:m,children:e.jsx(f,{icon:"material-symbols:close"})})})})]}),e.jsx(j,{container:!0,rowGap:3,children:e.jsx(j,{item:!0,xs:12,children:e.jsxs(R,{sx:{mb:1},children:["Xác nhận xóa ",n.name,":"]})})}),e.jsxs(he,{children:[e.jsx(T,{variant:"outlined",color:"inherit",startIcon:e.jsx(f,{icon:"codicon:discard"}),onClick:m,children:"Hủy"}),e.jsx(T,{variant:"contained",color:"error",startIcon:e.jsx(f,{icon:"material-symbols:delete"}),onClick:k,children:"Xóa"})]})]})})]})}function Ie({numSelected:n,filterName:r,onFilterName:t}){return e.jsx(Z,{sx:{height:96,display:"flex",justifyContent:"space-between",p:a=>a.spacing(0,1,0,3),...n>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:n>0?e.jsxs(S,{component:"div",variant:"subtitle1",children:[n," selected"]}):e.jsx(ue,{fullWidth:!0,value:r,onChange:t,placeholder:"Tìm theo họ tên...",startAdornment:e.jsx(pe,{position:"start",children:e.jsx(f,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}})})}const Re=({file:n,endpoint:r})=>{const[t,a]=o.useState(!1),[l,d]=o.useState(),{enqueueSnackbar:i}=O(),{postFormData:s}=q(),g=o.useCallback(async()=>{a(!0);try{const h=new FormData;if(!n){i("Chưa có file được chọn!",{variant:"error"});return}h.append("file",n);const x=await s(r,h);if("error"in x){typeof x.error=="string"&&i(x.error,{variant:"error"});return}if("message"in x){typeof x.message=="string"&&i(x.message,{variant:"error"});return}const m=x.data[""],v=m.numErrorRecord,y=m.numSuccessRecord,k=m.totalRecord;v>0&&i(`Có ${v}/${k} bản ghi bị lỗi, hãy tải về file kết quả để xem chi tiết`,{variant:"error"}),y>0&&i(`Thêm mới ${y}/${k} nhân viên thành công`,{variant:"success"}),d(m)}catch(h){i(h.message,{variant:"error"})}finally{a(!1)}},[n,r,i,s]),P=o.useCallback(()=>{d(void 0),a(!1)},[]);return{isSubmitting:t,onImportFile:g,response:l,onResetState:P}},Fe=()=>{const[n,r]=o.useState(!1),{enqueueSnackbar:t}=O(),{remove:a}=q();return{deleteUserById:o.useCallback(async d=>{r(!0);try{const i=await a("/users",{id:d});i.statusCode===200?t("Xóa thành công",{variant:"success"}):t(i.error??i.message??"Unknown error",{variant:"error"})}catch(i){t(i.message,{variant:"error"})}finally{r(!1)}},[t,a]),isSubmitting:n}};function De(){const[n,r]=o.useState(!1),[t,a]=o.useState(),[l,d]=o.useState(""),i=ee(),s=Ae(),{enqueueSnackbar:g}=O(),{isLoading:P,users:h,refetchUsers:x}=fe(),{deleteUserById:m}=Fe(),{isDownloading:v,onDownloadFile:y}=ge({endpoint:"/users/download-example",fileName:"ThêmNhânViên_FileExcelMẫu.xlsx"}),{onImportFile:k,isSubmitting:p,response:c,onResetState:w}=Re({endpoint:"/users/import-user",file:t}),N=Pe({inputData:h,comparator:Se(s.order,s.orderBy),filterName:l}),H=!N.length&&!!l,W=o.useCallback(u=>{const I=u.target;I.files&&(a(I.files[0]),w())},[w]),z=o.useCallback(async()=>{await k(),x()},[k,x]),X=o.useCallback(()=>{const u=je(c==null?void 0:c.file);if(!u){g("Lỗi không tìm thấy Blob File",{variant:"error"});return}be(u,"ThêmNhânViên_FileExcelKếtQuả.xlsx")},[c,g]),E=o.useCallback(()=>a(void 0),[]),_=o.useCallback(()=>{E(),w()},[E,w]),K=o.useCallback(u=>{i.push(`/nhan-vien/${u.id}`)},[i]),Q=o.useCallback(async u=>{await m(u.id),x()},[m,x]);return e.jsxs(ne,{children:[e.jsxs(C,{display:"flex",alignItems:"center",mb:5,children:[e.jsxs(S,{variant:"h4",flexGrow:1,children:["Nhân viên (",h.length,")"]}),e.jsx(T,{variant:"contained",color:"inherit",startIcon:e.jsx(f,{icon:"mingcute:add-line"}),onClick:()=>r(!0),children:"Thêm mới"})]}),e.jsxs(xe,{children:[e.jsx(Ie,{numSelected:s.selected.length,filterName:l,onFilterName:u=>{d(u.target.value),s.onResetPage()}}),e.jsx(se,{children:e.jsx(ae,{sx:{overflow:"unset"},children:e.jsxs(le,{sx:{minWidth:800},children:[e.jsx(we,{order:s.order,orderBy:s.orderBy,rowCount:h.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:u=>s.onSelectAllRows(u,h.map(I=>I.identifyCard)),headLabel:[{id:"name",label:"Họ tên"},{id:"team",label:"Phòng ban"},{id:"hotline",label:"Liên hệ phòng"},{id:"role",label:"Chức vụ"},{id:"phone",label:"Số điện thoại",align:"left"},{id:"address",label:"Địa chỉ"},{id:"email",label:"Email"},{id:""}]}),e.jsxs(ce,{children:[N.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(u=>e.jsx(Te,{row:u,selected:s.selected.includes(u.identifyCard),onSelectRow:()=>s.onSelectRow(u.identifyCard),onDeleteUser:Q,onGotoDetail:K},u.identifyCard)),e.jsx(Ce,{height:68,emptyRows:ye(s.page,s.rowsPerPage,h.length)}),H&&e.jsx(ve,{searchQuery:l})]})]})})}),e.jsx(de,{component:"div",page:s.page,count:h.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,15,25,h.length],onRowsPerPageChange:s.onChangeRowsPerPage})]}),e.jsx($,{open:n,onClose:()=>r(!1),children:e.jsxs(C,{sx:{p:4,pb:8},children:[e.jsxs(C,{position:"relative",children:[e.jsx(G,{sx:{textAlign:"center"},children:"Nhập bằng file excel"}),e.jsx(C,{position:"absolute",top:"15%",left:0,children:e.jsx(A,{title:"Thực hiện lại",children:e.jsx(F,{onClick:_,children:e.jsx(f,{icon:"mage:reload"})})})}),e.jsx(C,{position:"absolute",top:"15%",right:0,children:e.jsx(A,{title:"Đóng",children:e.jsx(F,{onClick:()=>r(!1),children:e.jsx(f,{icon:"material-symbols:close"})})})})]}),e.jsxs(j,{container:!0,rowGap:3,children:[e.jsxs(j,{item:!0,xs:12,children:[e.jsx(R,{sx:{mb:1},children:"1. Tải về file excel mẫu:"}),e.jsx(T,{variant:"contained",color:"inherit",startIcon:e.jsx(f,{icon:"material-symbols:download"}),onClick:y,disabled:v,children:"Tải về"})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(R,{sx:{mb:2},children:"2. Tải lên file excel đã điền thông tin Nhân viên:"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(me,{type:"file",onChange:W,label:"Chọn file excel",InputLabelProps:{shrink:!0,sx:{fontSize:20}},inputProps:{accept:".xls, .xlsx, .csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv"}})}),e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(T,{onClick:z,variant:"contained",color:"info",startIcon:e.jsx(f,{icon:"line-md:upload-loop"}),disabled:!t||p,children:"Tải lên"})})]})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(R,{sx:{mb:2},children:"3. Kết quả:"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsxs(j,{item:!0,xs:12,md:12,children:[e.jsxs(S,{children:["Tổng số bản ghi gửi lên: ",(c==null?void 0:c.totalRecord)??"-"]}),e.jsxs(S,{children:["Số bản ghi nhập thành công: ",(c==null?void 0:c.numSuccessRecord)??"-"]}),e.jsxs(S,{children:["Số bản ghi nhập thất bại: ",(c==null?void 0:c.numErrorRecord)??"-"]})]}),e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(T,{onClick:X,variant:"contained",color:"primary",startIcon:e.jsx(f,{icon:"carbon:result-new"}),disabled:!(c!=null&&c.file),children:"Tải về xem file kết quả"})})]})]})]})]})})]})}function Ae(){const[n,r]=o.useState(0),[t,a]=o.useState("name"),[l,d]=o.useState(5),[i,s]=o.useState([]),[g,P]=o.useState("asc"),h=o.useCallback(p=>{P(t===p&&g==="asc"?"desc":"asc"),a(p)},[g,t]),x=o.useCallback((p,c)=>{if(p){s(c);return}s([])},[]),m=o.useCallback(p=>{const c=i.includes(p)?i.filter(w=>w!==p):[...i,p];s(c)},[i]),v=o.useCallback(()=>{r(0)},[]),y=o.useCallback((p,c)=>{r(c)},[]),k=o.useCallback(p=>{d(parseInt(p.target.value,10)),v()},[v]);return{page:n,order:g,onSort:h,orderBy:t,selected:i,rowsPerPage:l,onSelectRow:m,onResetPage:v,onChangePage:y,onSelectAllRows:x,onChangeRowsPerPage:k}}function He(){return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsxs("title",{children:[" ",`Nhân viên - ${re.appName}`]})}),e.jsx(De,{})]})}export{He as default};
