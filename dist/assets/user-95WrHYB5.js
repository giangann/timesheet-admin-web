import{j as e,B as C,T as I,r as o,A as ne,I as R,a as p,P as se,M as te,m as G,b as L,c as w,d as oe,u as N,e as ie,D as ae,S as re,H as le}from"./index-C8lk817k.js";import{C as ce}from"./config-global-ClKwKbZP.js";import{T as D,a as f,b as de,C as q,c as he,D as B,d as A,e as F,f as xe,g as ue,h as me,i as pe}from"./Tooltip-BFas_5jx.js";import{D as O,a as X}from"./dialogTitleClasses-B-ld9CFH.js";import{G as j,C as fe}from"./Grid-CuOb3N_t.js";import{O as be,T as ge}from"./TextField-7QqntMl9.js";import{I as je}from"./InputAdornment-DNg53QyW.js";import{u as Ce,s as ve}from"./use-download-2axmrzeF.js";import{u as ke}from"./use-user-M6u3FO38.js";import{u as W}from"./use-api--dau0ow6.js";import"./map-util-BcGf2YPr.js";function ye(n){if(!n)return;const t=atob(n),i=new Array(t.length);t.split("").forEach((c,a)=>{i[a]=t.charCodeAt(a)});const r=new Uint8Array(i);return new Blob([r])}function Se({emptyRows:n,height:t,sx:i,...r}){return n?e.jsx(D,{sx:{...t&&{height:t*n},...i},...r,children:e.jsx(f,{colSpan:9})}):null}function we({searchQuery:n,...t}){return e.jsx(D,{...t,children:e.jsx(f,{align:"center",colSpan:7,children:e.jsxs(C,{sx:{py:15,textAlign:"center"},children:[e.jsx(I,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(I,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',n,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const Ie={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Pe(n,t,i){return n?Math.max(0,(1+n)*t-i):0}function $(n,t,i){return t[i]<n[i]?-1:t[i]>n[i]?1:0}function Te(n,t){return n==="desc"?(i,r)=>$(i,r,t):(i,r)=>-$(i,r,t)}function Re({inputData:n,comparator:t,filterName:i}){const r=n.map((l,c)=>[l,c]);return r.sort((l,c)=>{const a=t(l[0],c[0]);return a!==0?a:l[1]-c[1]}),n=r.map(l=>l[0]),i&&(n=n.filter(l=>l.name.toLowerCase().indexOf(i.toLowerCase())!==-1)),n}function Fe(n){return n.map(t=>({id:t.id,name:t.name,email:t.email??"-",address:t.address??"-",phone:t.phone??"-",identifyCard:t.identifyCard??"-",roleName:t.roleName,roleCode:t.roleCode,teamName:t.team.name,teamCode:t.team.code??"-",teamHotline:t.team.hotline??"-",salaryCoefficient:t.salaryCoefficient??"-",positionBonusCoefficient:t.positionBonusCoefficient??"-",otherBonusCoefficient:t.otherBonusCoefficient??"-"}))}function Ae({order:n,onSort:t,orderBy:i,rowCount:r,headLabel:l,numSelected:c,onSelectAllRows:a}){return e.jsx(de,{children:e.jsxs(D,{children:[e.jsx(f,{padding:"checkbox",children:e.jsx(q,{indeterminate:c>0&&c<r,checked:r>0&&c===r,onChange:s=>a(s.target.checked)})}),l.map(s=>e.jsx(f,{align:s.align||"left",sortDirection:i===s.id?n:!1,sx:{width:s.width,minWidth:s.minWidth},children:e.jsxs(he,{hideSortIcon:!0,active:i===s.id,direction:i===s.id?n:"asc",onClick:()=>t(s.id),children:[s.label,i===s.id?e.jsx(C,{sx:{...Ie},children:n==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id))]})})}function De({row:n,selected:t,onSelectRow:i,onDeleteUser:r,onGotoDetail:l}){const[c,a]=o.useState(null),[s,b]=o.useState(!1),y=o.useCallback(g=>{a(g.currentTarget)},[]),h=o.useCallback(()=>{a(null)},[]),u=o.useCallback(()=>{b(!0)},[b]),m=o.useCallback(()=>{b(!1)},[b]),v=o.useCallback(()=>{h(),u()},[h,u]),S=o.useCallback(()=>{h(),l(n)},[h,l,n]),k=o.useCallback(()=>{m(),r(n)},[m,r,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(D,{hover:!0,tabIndex:-1,role:"checkbox",selected:t,children:[e.jsx(f,{padding:"checkbox",children:e.jsx(q,{disableRipple:!0,checked:t,onChange:i})}),e.jsx(f,{component:"th",scope:"row",children:e.jsxs(C,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(ne,{alt:n.name,src:"null"}),n.name]})}),e.jsx(f,{children:n.teamName}),e.jsx(f,{children:n.teamHotline}),e.jsx(f,{children:n.roleName}),e.jsx(f,{children:n.phone}),e.jsx(f,{children:n.address}),e.jsx(f,{children:n.email}),e.jsx(f,{children:n.salaryCoefficient}),e.jsx(f,{children:n.positionBonusCoefficient}),e.jsx(f,{children:n.otherBonusCoefficient}),e.jsx(f,{align:"right",children:e.jsx(R,{onClick:y,children:e.jsx(p,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(se,{open:!!c,anchorEl:c,onClose:h,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(te,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${G.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${G.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(L,{onClick:S,children:[e.jsx(p,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(L,{onClick:v,sx:{color:"error.main"},children:[e.jsx(p,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx(O,{open:s,onClose:m,children:e.jsxs(C,{sx:{p:4,pb:4},children:[e.jsxs(C,{position:"relative",children:[e.jsx(B,{sx:{textAlign:"left"},children:"Xác nhận xóa?"}),e.jsx(C,{position:"absolute",top:"15%",right:0,children:e.jsx(A,{title:"Đóng",children:e.jsx(R,{onClick:m,children:e.jsx(p,{icon:"material-symbols:close"})})})})]}),e.jsx(j,{container:!0,rowGap:3,children:e.jsx(j,{item:!0,xs:12,children:e.jsxs(F,{sx:{mb:1},children:["Xác nhận xóa ",n.name,":"]})})}),e.jsxs(X,{children:[e.jsx(w,{variant:"outlined",color:"inherit",startIcon:e.jsx(p,{icon:"codicon:discard"}),onClick:m,children:"Hủy"}),e.jsx(w,{variant:"contained",color:"error",startIcon:e.jsx(p,{icon:"material-symbols:delete"}),onClick:k,children:"Xóa"})]})]})})]})}function Ne({numSelected:n,filterName:t,onFilterName:i,onMultiDelete:r}){const[l,c]=o.useState(!1),a=o.useCallback(()=>{c(!0)},[c]),s=o.useCallback(()=>{c(!1)},[c]),b=o.useCallback(()=>{s(),r==null||r()},[s,r]);return e.jsxs(oe,{sx:{height:96,display:"flex",justifyContent:"space-between",p:y=>y.spacing(0,1,0,3),...n>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[n>0?e.jsxs(I,{component:"div",variant:"subtitle1",children:[n," selected"]}):e.jsx(be,{fullWidth:!0,value:t,onChange:i,placeholder:"Tìm theo họ tên...",startAdornment:e.jsx(je,{position:"start",children:e.jsx(p,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),n>0&&e.jsx(A,{title:"Delete",children:e.jsx(R,{onClick:a,children:e.jsx(p,{icon:"solar:trash-bin-trash-bold"})})}),e.jsx(O,{open:l,onClose:s,children:e.jsxs(C,{sx:{p:4,pb:4},children:[e.jsxs(C,{position:"relative",children:[e.jsx(B,{sx:{textAlign:"left"},children:"Xác nhận xóa?"}),e.jsx(C,{position:"absolute",top:"15%",right:0,children:e.jsx(A,{title:"Đóng",children:e.jsx(R,{onClick:s,children:e.jsx(p,{icon:"material-symbols:close"})})})})]}),e.jsx(j,{container:!0,rowGap:3,children:e.jsx(j,{item:!0,xs:12,children:e.jsxs(F,{sx:{mb:1},children:["Xác nhận xóa ",n," bản ghi"]})})}),e.jsxs(X,{children:[e.jsx(w,{variant:"outlined",color:"inherit",startIcon:e.jsx(p,{icon:"codicon:discard"}),onClick:s,children:"Hủy"}),e.jsx(w,{variant:"contained",color:"error",startIcon:e.jsx(p,{icon:"material-symbols:delete"}),onClick:b,children:"Xóa"})]})]})})]})}const Be=({file:n,endpoint:t})=>{const[i,r]=o.useState(!1),[l,c]=o.useState(),{enqueueSnackbar:a}=N(),{postFormData:s}=W(),b=o.useCallback(async()=>{r(!0);try{const h=new FormData;if(!n){a("Chưa có file được chọn!",{variant:"error"});return}h.append("file",n);const u=await s(t,h);if("error"in u){typeof u.error=="string"&&a(u.error,{variant:"error"});return}if("message"in u){typeof u.message=="string"&&a(u.message,{variant:"error"});return}const m=u.data[""],v=m.numErrorRecord,S=m.numSuccessRecord,k=m.totalRecord;v>0&&a(`Có ${v}/${k} bản ghi bị lỗi, hãy tải về file kết quả để xem chi tiết`,{variant:"error"}),S>0&&a(`Thêm mới ${S}/${k} nhân viên thành công`,{variant:"success"}),c(m)}catch(h){a(h.message,{variant:"error"})}finally{r(!1)}},[n,t,a,s]),y=o.useCallback(()=>{c(void 0),r(!1)},[]);return{isSubmitting:i,onImportFile:b,response:l,onResetState:y}},Oe=()=>{const[n,t]=o.useState(!1),{enqueueSnackbar:i}=N(),{remove:r}=W();return{deleteUserById:o.useCallback(async c=>{t(!0);try{const a=await r("/users",{id:c});a.statusCode===200?i("Xóa thành công",{variant:"success"}):i(a.error??a.message??"Unknown error",{variant:"error"})}catch(a){i(a.message,{variant:"error"})}finally{t(!1)}},[i,r]),isSubmitting:n}};function Ue(){const[n,t]=o.useState(!1),[i,r]=o.useState(),[l,c]=o.useState(""),a=ie(),s=Ee(),{enqueueSnackbar:b}=N(),{isLoading:y,users:h,refetchUsers:u}=ke(),{deleteUserById:m}=Oe(),{isDownloading:v,onDownloadFile:S}=Ce({endpoint:"/users/download-example",fileName:"ThêmNhânViên_FileExcelMẫu.xlsx"}),{onImportFile:k,isSubmitting:g,response:d,onResetState:P}=Be({endpoint:"/users/import-user",file:i}),U=Re({inputData:Fe(h),comparator:Te(s.order,s.orderBy),filterName:l}),z=!U.length&&!!l,_=o.useCallback(x=>{const T=x.target;T.files&&(r(T.files[0]),P())},[P]),K=o.useCallback(async()=>{await k(),u()},[k,u]),Q=o.useCallback(()=>{const x=ye(d==null?void 0:d.file);if(!x){b("Lỗi không tìm thấy Blob File",{variant:"error"});return}ve(x,"ThêmNhânViên_FileExcelKếtQuả.xlsx")},[d,b]),E=o.useCallback(()=>r(void 0),[]),J=o.useCallback(()=>{E(),P()},[E,P]),V=o.useCallback(x=>{a.push(`/nhan-vien/${x.id}`)},[a]),Y=o.useCallback(async x=>{await m(x.id),u()},[m,u]),H=o.useCallback(async x=>{await m(x),u()},[m,u]),Z=o.useCallback(x=>{s.onSelectAllRows(x,h.map(T=>T.id.toString()))},[h,s]),M=o.useCallback(()=>{s.onSelectAllRows(!1,[])},[s]),ee=o.useCallback(()=>{s.selected.forEach(T=>H(parseInt(T,10))),M()},[H,s,M]);return e.jsxs(ae,{children:[e.jsxs(C,{display:"flex",alignItems:"center",mb:5,children:[e.jsxs(I,{variant:"h4",flexGrow:1,children:["Nhân viên (",h.length,")"]}),e.jsx(w,{variant:"contained",color:"inherit",startIcon:e.jsx(p,{icon:"mingcute:add-line"}),onClick:()=>t(!0),children:"Thêm mới"})]}),e.jsxs(fe,{children:[e.jsx(Ne,{numSelected:s.selected.length,filterName:l,onFilterName:x=>{c(x.target.value),s.onResetPage()},onMultiDelete:ee}),e.jsx(re,{children:e.jsx(xe,{sx:{overflow:"unset"},children:e.jsxs(ue,{sx:{minWidth:800},children:[e.jsx(Ae,{order:s.order,orderBy:s.orderBy,rowCount:h.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:Z,headLabel:[{id:"name",label:"Họ tên"},{id:"teamName",label:"Phòng ban"},{id:"teamHotline",label:"Liên hệ phòng"},{id:"roleName",label:"Chức vụ"},{id:"phone",label:"Số điện thoại",align:"left"},{id:"address",label:"Địa chỉ"},{id:"email",label:"Email"},{id:"salaryCoefficient",label:"Hệ số lương"},{id:"positionBonusCoefficient",label:"Hệ số chức vụ"},{id:"otherBonusCoefficient",label:"Hệ số phụ cấp khác"},{id:""}]}),e.jsxs(me,{children:[U.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(x=>e.jsx(De,{row:x,selected:s.selected.includes(x.id.toString()),onSelectRow:()=>s.onSelectRow(x.id.toString()),onDeleteUser:Y,onGotoDetail:V},x.id.toString())),e.jsx(Se,{height:68,emptyRows:Pe(s.page,s.rowsPerPage,h.length)}),z&&e.jsx(we,{searchQuery:l})]})]})})}),e.jsx(pe,{component:"div",page:s.page,count:h.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,15,25,h.length],onRowsPerPageChange:s.onChangeRowsPerPage})]}),e.jsx(O,{open:n,onClose:()=>t(!1),children:e.jsxs(C,{sx:{p:4,pb:8},children:[e.jsxs(C,{position:"relative",children:[e.jsx(B,{sx:{textAlign:"center"},children:"Nhập bằng file excel"}),e.jsx(C,{position:"absolute",top:"15%",left:0,children:e.jsx(A,{title:"Thực hiện lại",children:e.jsx(R,{onClick:J,children:e.jsx(p,{icon:"mage:reload"})})})}),e.jsx(C,{position:"absolute",top:"15%",right:0,children:e.jsx(A,{title:"Đóng",children:e.jsx(R,{onClick:()=>t(!1),children:e.jsx(p,{icon:"material-symbols:close"})})})})]}),e.jsxs(j,{container:!0,rowGap:3,children:[e.jsxs(j,{item:!0,xs:12,children:[e.jsx(F,{sx:{mb:1},children:"1. Tải về file excel mẫu:"}),e.jsx(w,{variant:"contained",color:"inherit",startIcon:e.jsx(p,{icon:"material-symbols:download"}),onClick:S,disabled:v,children:"Tải về"})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(F,{sx:{mb:2},children:"2. Tải lên file excel đã điền thông tin Nhân viên:"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(ge,{type:"file",onChange:_,label:"Chọn file excel",InputLabelProps:{shrink:!0,sx:{fontSize:20}},inputProps:{accept:".xls, .xlsx, .csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv"}})}),e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(w,{onClick:K,variant:"contained",color:"info",startIcon:e.jsx(p,{icon:"line-md:upload-loop"}),disabled:!i||g,children:"Tải lên"})})]})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(F,{sx:{mb:2},children:"3. Kết quả:"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsxs(j,{item:!0,xs:12,md:12,children:[e.jsxs(I,{children:["Tổng số bản ghi gửi lên: ",(d==null?void 0:d.totalRecord)??"-"]}),e.jsxs(I,{children:["Số bản ghi nhập thành công: ",(d==null?void 0:d.numSuccessRecord)??"-"]}),e.jsxs(I,{children:["Số bản ghi nhập thất bại: ",(d==null?void 0:d.numErrorRecord)??"-"]})]}),e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(w,{onClick:Q,variant:"contained",color:"primary",startIcon:e.jsx(p,{icon:"carbon:result-new"}),disabled:!(d!=null&&d.file),children:"Tải về xem file kết quả"})})]})]})]})]})})]})}function Ee(){const[n,t]=o.useState(0),[i,r]=o.useState("name"),[l,c]=o.useState(5),[a,s]=o.useState([]),[b,y]=o.useState("asc"),h=o.useCallback(g=>{y(i===g&&b==="asc"?"desc":"asc"),r(g)},[b,i]),u=o.useCallback((g,d)=>{if(g){s(d);return}s([])},[]),m=o.useCallback(g=>{const d=a.includes(g)?a.filter(P=>P!==g):[...a,g];s(d)},[a]),v=o.useCallback(()=>{t(0)},[]),S=o.useCallback((g,d)=>{t(d)},[]),k=o.useCallback(g=>{c(parseInt(g.target.value,10)),v()},[v]);return{page:n,order:b,onSort:h,orderBy:i,selected:a,rowsPerPage:l,onSelectRow:m,onResetPage:v,onChangePage:S,onSelectAllRows:u,onChangeRowsPerPage:k}}function Qe(){return e.jsxs(e.Fragment,{children:[e.jsx(le,{children:e.jsxs("title",{children:[" ",`Nhân viên - ${ce.appName}`]})}),e.jsx(Ue,{})]})}export{Qe as default};
