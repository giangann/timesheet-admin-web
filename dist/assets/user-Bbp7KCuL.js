import{j as e,B as C,T as P,r as o,A as te,I as T,a as p,P as oe,M as ie,m as $,b as q,c as w,d as re,u as O,e as ae,f as le,D as ce,S as de,H as he}from"./index-AWtMA2-l.js";import{C as xe}from"./config-global-ClKwKbZP.js";import{T as N,a as b,b as ue,C as W,c as me,D as U,d as A,e as F,f as pe,g as fe,h as be,i as ge}from"./Tooltip-Dc4dyHbn.js";import{D as E,a as z}from"./dialogTitleClasses-DXzmAHZt.js";import{G as j,C as je}from"./Grid-Ei3VFYdc.js";import{O as Ce,T as ve}from"./TextField-XvLv7tpb.js";import{I as ke}from"./InputAdornment-B_kX0hSp.js";import{u as ye,s as Se}from"./use-download-COStxBuq.js";import{u as Ie}from"./use-user-vOmbG74d.js";import{u as _}from"./use-api-D3ixKDMA.js";import"./map-util-BcGf2YPr.js";function we(n){if(!n)return;const t=atob(n),i=new Array(t.length);t.split("").forEach((c,r)=>{i[r]=t.charCodeAt(r)});const a=new Uint8Array(i);return new Blob([a])}function Pe({emptyRows:n,height:t,sx:i,...a}){return n?e.jsx(N,{sx:{...t&&{height:t*n},...i},...a,children:e.jsx(b,{colSpan:9})}):null}function Te({searchQuery:n,...t}){return e.jsx(N,{...t,children:e.jsx(b,{align:"center",colSpan:7,children:e.jsxs(C,{sx:{py:15,textAlign:"center"},children:[e.jsx(P,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(P,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',n,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const Re={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Fe(n,t,i){return n?Math.max(0,(1+n)*t-i):0}function X(n,t,i){return t[i]<n[i]?-1:t[i]>n[i]?1:0}function Ae(n,t){return n==="desc"?(i,a)=>X(i,a,t):(i,a)=>-X(i,a,t)}function De({inputData:n,comparator:t,filterName:i}){const a=n.map((l,c)=>[l,c]);return a.sort((l,c)=>{const r=t(l[0],c[0]);return r!==0?r:l[1]-c[1]}),n=a.map(l=>l[0]),i&&(n=n.filter(l=>l.name.toLowerCase().indexOf(i.toLowerCase())!==-1)),n}function Ne(n){return n.map(t=>({id:t.id,name:t.name,email:t.email??"-",address:t.address??"-",phone:t.phone??"-",identifyCard:t.identifyCard??"-",roleName:t.roleName,roleCode:t.roleCode,teamName:t.team.name,teamCode:t.team.code??"-",teamHotline:t.team.hotline??"-",salaryCoefficient:t.salaryCoefficient??"-",positionBonusCoefficient:t.positionBonusCoefficient??"-",otherBonusCoefficient:t.otherBonusCoefficient??"-"}))}function Be({order:n,onSort:t,orderBy:i,rowCount:a,headLabel:l,numSelected:c,onSelectAllRows:r}){return e.jsx(ue,{children:e.jsxs(N,{children:[e.jsx(b,{padding:"checkbox",children:e.jsx(W,{indeterminate:c>0&&c<a,checked:a>0&&c===a,onChange:s=>r(s.target.checked)})}),l.map(s=>e.jsx(b,{align:s.align||"left",sortDirection:i===s.id?n:!1,sx:{width:s.width,minWidth:s.minWidth},children:e.jsxs(me,{hideSortIcon:!0,active:i===s.id,direction:i===s.id?n:"asc",onClick:()=>t(s.id),children:[s.label,i===s.id?e.jsx(C,{sx:{...Re},children:n==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id))]})})}function Oe({row:n,selected:t,onSelectRow:i,onDeleteUser:a,onGotoDetail:l}){const[c,r]=o.useState(null),[s,g]=o.useState(!1),k=o.useCallback(f=>{r(f.currentTarget)},[]),d=o.useCallback(()=>{r(null)},[]),x=o.useCallback(()=>{g(!0)},[g]),m=o.useCallback(()=>{g(!1)},[g]),v=o.useCallback(()=>{d(),x()},[d,x]),y=o.useCallback(()=>{d(),l(n)},[d,l,n]),S=o.useCallback(()=>{m(),a(n)},[m,a,n]);return e.jsxs(e.Fragment,{children:[e.jsxs(N,{hover:!0,tabIndex:-1,role:"checkbox",selected:t,children:[e.jsx(b,{padding:"checkbox",children:e.jsx(W,{disableRipple:!0,checked:t,onChange:i})}),e.jsx(b,{component:"th",scope:"row",children:e.jsxs(C,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(te,{alt:n.name,src:"null"}),n.name]})}),e.jsx(b,{children:n.teamName}),e.jsx(b,{children:n.teamHotline}),e.jsx(b,{children:n.roleName}),e.jsx(b,{children:n.phone}),e.jsx(b,{children:n.address}),e.jsx(b,{children:n.email}),e.jsx(b,{children:n.salaryCoefficient}),e.jsx(b,{children:n.positionBonusCoefficient}),e.jsx(b,{children:n.otherBonusCoefficient}),e.jsx(b,{align:"right",children:e.jsx(T,{onClick:k,children:e.jsx(p,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(oe,{open:!!c,anchorEl:c,onClose:d,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(ie,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${$.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${$.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(q,{onClick:y,children:[e.jsx(p,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(q,{onClick:v,sx:{color:"error.main"},children:[e.jsx(p,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsx(E,{open:s,onClose:m,children:e.jsxs(C,{sx:{p:4,pb:4},children:[e.jsxs(C,{position:"relative",children:[e.jsx(U,{sx:{textAlign:"left"},children:"Xác nhận xóa?"}),e.jsx(C,{position:"absolute",top:"15%",right:0,children:e.jsx(A,{title:"Đóng",children:e.jsx(T,{onClick:m,children:e.jsx(p,{icon:"material-symbols:close"})})})})]}),e.jsx(j,{container:!0,rowGap:3,children:e.jsx(j,{item:!0,xs:12,children:e.jsxs(F,{sx:{mb:1},children:["Xác nhận xóa ",n.name,":"]})})}),e.jsxs(z,{children:[e.jsx(w,{variant:"outlined",color:"inherit",startIcon:e.jsx(p,{icon:"codicon:discard"}),onClick:m,children:"Hủy"}),e.jsx(w,{variant:"contained",color:"error",startIcon:e.jsx(p,{icon:"material-symbols:delete"}),onClick:S,children:"Xóa"})]})]})})]})}function Ue({numSelected:n,filterName:t,onFilterName:i,onMultiDelete:a}){const[l,c]=o.useState(!1),r=o.useCallback(()=>{c(!0)},[c]),s=o.useCallback(()=>{c(!1)},[c]),g=o.useCallback(()=>{s(),a==null||a()},[s,a]);return e.jsxs(re,{sx:{height:96,display:"flex",justifyContent:"space-between",p:k=>k.spacing(0,1,0,3),...n>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[n>0?e.jsxs(P,{component:"div",variant:"subtitle1",children:[n," selected"]}):e.jsx(Ce,{fullWidth:!0,value:t,onChange:i,placeholder:"Tìm theo họ tên...",startAdornment:e.jsx(ke,{position:"start",children:e.jsx(p,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),n>0&&e.jsx(A,{title:"Delete",children:e.jsx(T,{onClick:r,children:e.jsx(p,{icon:"solar:trash-bin-trash-bold"})})}),e.jsx(E,{open:l,onClose:s,children:e.jsxs(C,{sx:{p:4,pb:4},children:[e.jsxs(C,{position:"relative",children:[e.jsx(U,{sx:{textAlign:"left"},children:"Xác nhận xóa?"}),e.jsx(C,{position:"absolute",top:"15%",right:0,children:e.jsx(A,{title:"Đóng",children:e.jsx(T,{onClick:s,children:e.jsx(p,{icon:"material-symbols:close"})})})})]}),e.jsx(j,{container:!0,rowGap:3,children:e.jsx(j,{item:!0,xs:12,children:e.jsxs(F,{sx:{mb:1},children:["Xác nhận xóa ",n," bản ghi"]})})}),e.jsxs(z,{children:[e.jsx(w,{variant:"outlined",color:"inherit",startIcon:e.jsx(p,{icon:"codicon:discard"}),onClick:s,children:"Hủy"}),e.jsx(w,{variant:"contained",color:"error",startIcon:e.jsx(p,{icon:"material-symbols:delete"}),onClick:g,children:"Xóa"})]})]})})]})}const Ee=({file:n,endpoint:t})=>{const[i,a]=o.useState(!1),[l,c]=o.useState(),{enqueueSnackbar:r}=O(),{postFormData:s}=_(),g=o.useCallback(async()=>{a(!0);try{const d=new FormData;if(!n){r("Chưa có file được chọn!",{variant:"error"});return}d.append("file",n);const x=await s(t,d);if("error"in x){typeof x.error=="string"&&r(x.error,{variant:"error"});return}if("message"in x){typeof x.message=="string"&&r(x.message,{variant:"error"});return}const m=x.data[""],v=m.numErrorRecord,y=m.numSuccessRecord,S=m.totalRecord;v>0&&r(`Có ${v}/${S} bản ghi bị lỗi, hãy tải về file kết quả để xem chi tiết`,{variant:"error"}),y>0&&r(`Thêm mới ${y}/${S} nhân viên thành công`,{variant:"success"}),c(m)}catch(d){r(d.message,{variant:"error"})}finally{a(!1)}},[n,t,r,s]),k=o.useCallback(()=>{c(void 0),a(!1)},[]);return{isSubmitting:i,onImportFile:g,response:l,onResetState:k}},He=()=>{const[n,t]=o.useState(!1),{enqueueSnackbar:i}=O(),{remove:a}=_();return{deleteUserById:o.useCallback(async c=>{t(!0);try{const r=await a("/users",{id:c});r.statusCode===200?i("Xóa thành công",{variant:"success"}):i(r.error??r.message??"Unknown error",{variant:"error"})}catch(r){i(r.message,{variant:"error"})}finally{t(!1)}},[i,a]),isSubmitting:n}};function Me(){const[n,t]=o.useState(!1),[i,a]=o.useState(),[l,c]=o.useState(""),r=ae(),s=Ge(),{enqueueSnackbar:g}=O(),{isLoading:k,users:d,refetchUsers:x}=Ie(),{deleteUserById:m}=He(),{user:v}=le(),{isDownloading:y,onDownloadFile:S}=ye({endpoint:"/users/download-example",fileName:"ThêmNhânViên_FileExcelMẫu.xlsx"}),{onImportFile:f,isSubmitting:I,response:u,onResetState:D}=Ee({endpoint:"/users/import-user",file:i}),H=De({inputData:Ne(d),comparator:Ae(s.order,s.orderBy),filterName:l}),K=!H.length&&!!l,Q=o.useCallback(h=>{const R=h.target;R.files&&(a(R.files[0]),D())},[D]),J=o.useCallback(async()=>{await f(),x()},[f,x]),V=o.useCallback(()=>{const h=we(u==null?void 0:u.file);if(!h){g("Lỗi không tìm thấy Blob File",{variant:"error"});return}Se(h,"ThêmNhânViên_FileExcelKếtQuả.xlsx")},[u,g]),M=o.useCallback(()=>a(void 0),[]),Y=o.useCallback(()=>{M(),D()},[M,D]),Z=o.useCallback(h=>{r.push(`/nhan-vien/${h.id}`)},[r]),ee=o.useCallback(async h=>{await m(h.id),x()},[m,x]),G=o.useCallback(async h=>{await m(h),x()},[m,x]),ne=o.useCallback(h=>{s.onSelectAllRows(h,d.map(R=>R.id.toString()))},[d,s]),L=o.useCallback(()=>{s.onSelectAllRows(!1,[])},[s]),se=o.useCallback(()=>{if(!v)return;const h=v.id.toString();s.selected.filter(B=>B!==h).forEach(B=>G(parseInt(B,10))),L()},[G,s,L,v]);return e.jsxs(ce,{children:[e.jsxs(C,{display:"flex",alignItems:"center",mb:5,children:[e.jsxs(P,{variant:"h4",flexGrow:1,children:["Nhân viên (",d.length,")"]}),e.jsx(w,{variant:"contained",color:"inherit",startIcon:e.jsx(p,{icon:"mingcute:add-line"}),onClick:()=>t(!0),children:"Thêm mới"})]}),e.jsxs(je,{children:[e.jsx(Ue,{numSelected:s.selected.length,filterName:l,onFilterName:h=>{c(h.target.value),s.onResetPage()},onMultiDelete:se}),e.jsx(de,{children:e.jsx(pe,{sx:{overflow:"unset"},children:e.jsxs(fe,{sx:{minWidth:800},children:[e.jsx(Be,{order:s.order,orderBy:s.orderBy,rowCount:d.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:ne,headLabel:[{id:"name",label:"Họ tên"},{id:"teamName",label:"Phòng ban"},{id:"teamHotline",label:"Liên hệ phòng"},{id:"roleName",label:"Chức vụ"},{id:"phone",label:"Số điện thoại",align:"left"},{id:"address",label:"Địa chỉ"},{id:"email",label:"Email"},{id:"salaryCoefficient",label:"Hệ số lương"},{id:"positionBonusCoefficient",label:"Hệ số chức vụ"},{id:"otherBonusCoefficient",label:"Hệ số phụ cấp khác"},{id:""}]}),e.jsxs(be,{children:[H.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(h=>e.jsx(Oe,{row:h,selected:s.selected.includes(h.id.toString()),onSelectRow:()=>s.onSelectRow(h.id.toString()),onDeleteUser:ee,onGotoDetail:Z},h.id.toString())),e.jsx(Pe,{height:68,emptyRows:Fe(s.page,s.rowsPerPage,d.length)}),K&&e.jsx(Te,{searchQuery:l})]})]})})}),e.jsx(ge,{component:"div",page:s.page,count:d.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,15,25,d.length],onRowsPerPageChange:s.onChangeRowsPerPage})]}),e.jsx(E,{open:n,onClose:()=>t(!1),children:e.jsxs(C,{sx:{p:4,pb:8},children:[e.jsxs(C,{position:"relative",children:[e.jsx(U,{sx:{textAlign:"center"},children:"Nhập bằng file excel"}),e.jsx(C,{position:"absolute",top:"15%",left:0,children:e.jsx(A,{title:"Thực hiện lại",children:e.jsx(T,{onClick:Y,children:e.jsx(p,{icon:"mage:reload"})})})}),e.jsx(C,{position:"absolute",top:"15%",right:0,children:e.jsx(A,{title:"Đóng",children:e.jsx(T,{onClick:()=>t(!1),children:e.jsx(p,{icon:"material-symbols:close"})})})})]}),e.jsxs(j,{container:!0,rowGap:3,children:[e.jsxs(j,{item:!0,xs:12,children:[e.jsx(F,{sx:{mb:1},children:"1. Tải về file excel mẫu:"}),e.jsx(w,{variant:"contained",color:"inherit",startIcon:e.jsx(p,{icon:"material-symbols:download"}),onClick:S,disabled:y,children:"Tải về"})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(F,{sx:{mb:2},children:"2. Tải lên file excel đã điền thông tin Nhân viên:"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(ve,{type:"file",onChange:Q,label:"Chọn file excel",InputLabelProps:{shrink:!0,sx:{fontSize:20}},inputProps:{accept:".xls, .xlsx, .csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv"}})}),e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(w,{onClick:J,variant:"contained",color:"info",startIcon:e.jsx(p,{icon:"line-md:upload-loop"}),disabled:!i||I,children:"Tải lên"})})]})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(F,{sx:{mb:2},children:"3. Kết quả:"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsxs(j,{item:!0,xs:12,md:12,children:[e.jsxs(P,{children:["Tổng số bản ghi gửi lên: ",(u==null?void 0:u.totalRecord)??"-"]}),e.jsxs(P,{children:["Số bản ghi nhập thành công: ",(u==null?void 0:u.numSuccessRecord)??"-"]}),e.jsxs(P,{children:["Số bản ghi nhập thất bại: ",(u==null?void 0:u.numErrorRecord)??"-"]})]}),e.jsx(j,{item:!0,xs:12,md:12,children:e.jsx(w,{onClick:V,variant:"contained",color:"primary",startIcon:e.jsx(p,{icon:"carbon:result-new"}),disabled:!(u!=null&&u.file),children:"Tải về xem file kết quả"})})]})]})]})]})})]})}function Ge(){const[n,t]=o.useState(0),[i,a]=o.useState("name"),[l,c]=o.useState(5),[r,s]=o.useState([]),[g,k]=o.useState("asc"),d=o.useCallback(f=>{k(i===f&&g==="asc"?"desc":"asc"),a(f)},[g,i]),x=o.useCallback((f,I)=>{if(f){s(I);return}s([])},[]),m=o.useCallback(f=>{const I=r.includes(f)?r.filter(u=>u!==f):[...r,f];s(I)},[r]),v=o.useCallback(()=>{t(0)},[]),y=o.useCallback((f,I)=>{t(I)},[]),S=o.useCallback(f=>{c(parseInt(f.target.value,10)),v()},[v]);return{page:n,order:g,onSort:d,orderBy:i,selected:r,rowsPerPage:l,onSelectRow:m,onResetPage:v,onChangePage:y,onSelectAllRows:x,onChangeRowsPerPage:S}}function Ye(){return e.jsxs(e.Fragment,{children:[e.jsx(he,{children:e.jsxs("title",{children:[" ",`Nhân viên - ${xe.appName}`]})}),e.jsx(Me,{})]})}export{Ye as default};
